/**
 * TiddlyBit - v0.0.1
 * A tiddly JavaScript library for constructing, parsing and serializing Bitcoin scripts.
 * https://github.com/libitx/tiddlybit#readme
 * Copyright Â© 2020 libitx. MIT License
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).TiddlyBit=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var o=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){!function(t){var e="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),r="/".charCodeAt(0),o="0".charCodeAt(0),u="a".charCodeAt(0),f="A".charCodeAt(0),i="-".charCodeAt(0),a="_".charCodeAt(0);function O(t){var e=t.charCodeAt(0);return e===n||e===i?62:e===r||e===a?63:e<o?-1:e<o+10?e-o+26+26:e<f+26?e-f:e<u+26?e-u+26:void 0}t.toByteArray=function(t){var n,r,o,u,f,i;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var a=t.length;f="="===t.charAt(a-2)?2:"="===t.charAt(a-1)?1:0,i=new e(3*t.length/4-f),o=f>0?t.length-4:t.length;var c=0;function P(t){i[c++]=t}for(n=0,r=0;n<o;n+=4,r+=3)P((16711680&(u=O(t.charAt(n))<<18|O(t.charAt(n+1))<<12|O(t.charAt(n+2))<<6|O(t.charAt(n+3))))>>16),P((65280&u)>>8),P(255&u);return 2===f?P(255&(u=O(t.charAt(n))<<2|O(t.charAt(n+1))>>4)):1===f&&(P((u=O(t.charAt(n))<<10|O(t.charAt(n+1))<<4|O(t.charAt(n+2))>>2)>>8&255),P(255&u)),i},t.fromByteArray=function(t){var e,n,r,o,u=t.length%3,f="";function i(t){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)}for(e=0,r=t.length-u;e<r;e+=3)n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],f+=i((o=n)>>18&63)+i(o>>12&63)+i(o>>6&63)+i(63&o);switch(u){case 1:f+=i((n=t[t.length-1])>>2),f+=i(n<<4&63),f+="==";break;case 2:f+=i((n=(t[t.length-2]<<8)+t[t.length-1])>>10),f+=i(n>>4&63),f+=i(n<<2&63),f+="="}return f}}(e)})),u=function(t,e){if(Array.isArray(t))return new Uint8Array(t);return f[e||"utf8"](t)},f={hex:function(t){for(var e=t.length/2,n=new Uint8Array(e),r="",o=0,u=t.length;o<u;++o)r+=t.charAt(o),o>0&&o%2==1&&(n[o>>>1]=parseInt(r,16),r="");return n},utf8:function(t){for(var e,n=[],r=0,o=t.length;r<o;++r)!1!==(e=a(t,r))&&(e<128?n[n.length]=e:i(n,e));return new Uint8Array(n)},base64:function(t){return new Uint8Array(o.toByteArray(t))}};function i(t,e){var n,r,o,u=e,f=0;do{++f}while(u>>>=1);for(r|=[0,0,192,224,240,248,252][n=0|Math.ceil((f-1)/5)],f=7-(o=[0,0,3,4,5,6,7][n])+6*(n-1);f;)r|=+!!(e&1<<f)<<7-o,++o%8==0&&(t[t.length]=r,r=128,o=2),--f;o&&(r|=+!!(1&e)<<7-o,t[t.length]=r)}function a(t,e){e=e||0;var n,r,o=t.charCodeAt(e);if(55296<=o&&o<=56319){if(n=t.charCodeAt(e+1),r=o,isNaN(n))throw new Error("High surrogate not followed by low surrogate");return 1024*(r-55296)+(n-56320)+65536}return!(56320<=o&&o<=57343)&&o}var O=function(t,e,n){n=void 0===n?t.length:n;var r,o,u=0,f=0;P.length=c.length=0;for(;u<t.length;)o=t[u],!f&&128&o?(r=l(o),f+=r,r<8&&(P[P.length]=o&_[6-r])):f?(P[P.length]=o&_[6],!--f&&P.length&&(c[c.length]=s(g(P)),P.length=0)):c[c.length]=s(o),++u;P.length&&!f&&(c[c.length]=s(g(P)),P.length=0);return c.join("")},c=[],P=[],s=String.fromCharCode,h=[64,32,16,8,4,2,1],_=[0,1,3,7,15,31,63,127];function l(t){for(var e=0;e<7&&t&h[e];++e);return e}function g(t){for(var e=0,n=0,r=t.length;n<r;++n)e|=t[n]<<6*(r-n-1);return e}var y=function(t,e){return E[e||"utf8"](t)},E={hex:function(t){for(var e,n="",r=0,o=t.length;r<o;++r)e=t[r],n+=((240&e)>>>4).toString(16),n+=(15&e).toString(16);return n},utf8:function(t){return O(t)},base64:function(t){return o.fromByteArray(t)}};var A=function(t,e,n){return t.subarray(e||0,n||t.length)};var I=function(t,e){if(!t.length)return new Uint8Array(0);var n=void 0!==e?e:function(t){for(var e=0,n=0,r=t.length;n<r;++n)e+=t[n].byteLength;return e}(t),r=new Uint8Array(n),o=t[0],u=o.length,f=0,i=0,a=0;for(;a<n;)i!==u?r[a++]=o[i++]:(i=0,++f,o=t[f],u=o&&o.length);return r};var U=function(t,e,n,r,o){if(n=arguments.length<3?0:n,r=arguments.length<4?0:r,(o=arguments.length<5?t.length:o)===r)return;if(0===e.length||0===t.length)return;o>t.length&&(o=t.length);e.length-n<o-r&&(o=e.length-n+r);if(t.buffer!==e.buffer)return b(t,e,n,r,o);return v(t,e,n,r,o)},d=[].slice;function b(t,e,n,r,o){for(var u=o-r+n,f=n,i=r;f<u;++f,++i)e[f]=t[i]}function v(t,e,n,r,o){for(var u=o+r,f=new Uint8Array(d.call(t,r,u)),i=0;r<u;++r,++i)e[n++]=f[i]}var p,w,S=p={};w="undefined"==typeof WeakMap?null:new WeakMap,p.get=w?function(t){var e=w.get(t.buffer);e||w.set(t.buffer,e=new DataView(t.buffer,0));return e}:function(t){return new DataView(t.buffer,0)};var N={readUInt8:function(t,e){return t[e]},readInt8:function(t,e){var n=t[e];return n<128?n:n-256},readUInt16LE:function(t,e){return S.get(t).getUint16(e+t.byteOffset,!0)},readUInt32LE:function(t,e){return S.get(t).getUint32(e+t.byteOffset,!0)},readInt16LE:function(t,e){return S.get(t).getInt16(e+t.byteOffset,!0)},readInt32LE:function(t,e){return S.get(t).getInt32(e+t.byteOffset,!0)},readFloatLE:function(t,e){return S.get(t).getFloat32(e+t.byteOffset,!0)},readDoubleLE:function(t,e){return S.get(t).getFloat64(e+t.byteOffset,!0)},readUInt16BE:function(t,e){return S.get(t).getUint16(e+t.byteOffset,!1)},readUInt32BE:function(t,e){return S.get(t).getUint32(e+t.byteOffset,!1)},readInt16BE:function(t,e){return S.get(t).getInt16(e+t.byteOffset,!1)},readInt32BE:function(t,e){return S.get(t).getInt32(e+t.byteOffset,!1)},readFloatBE:function(t,e){return S.get(t).getFloat32(e+t.byteOffset,!1)},readDoubleBE:function(t,e){return S.get(t).getFloat64(e+t.byteOffset,!1)}};var L={writeUInt8:function(t,e,n){return t[n]=e},writeInt8:function(t,e,n){return t[n]=e<0?e+256:e},writeUInt16LE:function(t,e,n){return S.get(t).setUint16(n+t.byteOffset,e,!0)},writeUInt32LE:function(t,e,n){return S.get(t).setUint32(n+t.byteOffset,e,!0)},writeInt16LE:function(t,e,n){return S.get(t).setInt16(n+t.byteOffset,e,!0)},writeInt32LE:function(t,e,n){return S.get(t).setInt32(n+t.byteOffset,e,!0)},writeFloatLE:function(t,e,n){return S.get(t).setFloat32(n+t.byteOffset,e,!0)},writeDoubleLE:function(t,e,n){return S.get(t).setFloat64(n+t.byteOffset,e,!0)},writeUInt16BE:function(t,e,n){return S.get(t).setUint16(n+t.byteOffset,e,!1)},writeUInt32BE:function(t,e,n){return S.get(t).setUint32(n+t.byteOffset,e,!1)},writeInt16BE:function(t,e,n){return S.get(t).setInt16(n+t.byteOffset,e,!1)},writeInt32BE:function(t,e,n){return S.get(t).setInt32(n+t.byteOffset,e,!1)},writeFloatBE:function(t,e,n){return S.get(t).setFloat32(n+t.byteOffset,e,!1)},writeDoubleBE:function(t,e,n){return S.get(t).setFloat64(n+t.byteOffset,e,!1)}};var R={},T=R;function C(t,e){for(var n in t)e[n]=t[n]}R.from=u,R.to=y,R.is=function(t){return t instanceof Uint8Array},R.subarray=A,R.join=I,R.copy=U,R.create=function(t){return new Uint8Array(t)},C(N,R),C(L,R);var B={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SPLIT:127,OP_NUM2BIN:128,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_CHECKLOCKTIMEVERIFY:177,OP_CHECKSEQUENCEVERIFY:178,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255},OpCode=function(){function OpCode(n){switch(e(this,OpCode),t(n)){case"string":this.op=n.toUpperCase(),this.code=B[this.op];break;case"number":this.op=Object.keys(B).find((function(t){return B[t]===n})),this.code=n}if(!this.isValid)throw new Error("Invalid OpCode: ".concat(n))}return r(OpCode,[{key:"toBuffer",value:function(){var t=T.create(1);return T.writeUInt8(t,this.code,0),t}},{key:"inspect",value:function(){return"<OpCode ".concat(this.code," ").concat(this.op,">")}},{key:"isValid",get:function(){return!!this.op&&Object.keys(B).includes(this.op)&&Number.isInteger(this.code)&&Object.values(B).includes(this.code)}}]),OpCode}(),D=function(t){return new OpCode(t)},Script=function(){function Script(t){e(this,Script),this.chunks=[],this.push(t)}return r(Script,[{key:"push",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(n)?(n.forEach((function(n){var r,o=t(n);T.is(n)||"OpCode"===n.constructor.name?r=n:Array.isArray(n)&&n.every((function(t){return Number.isInteger(t)&&t<=255}))?r=T.from(n):"string"===o&&(r=T.from(n)),e.chunks.push(r)})),this):this.push([n])}},{key:"pushOp",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e))return this.push([e]);e.forEach((function(e){var n=D(e);t.chunks.push(n)}))}},{key:"toASM",value:function(){return this.chunks.map((function(t){return"OpCode"===t.constructor.name?0===t.code?"0":"OP_1NEGATE"===t.op?"-1":t.op:T.to(t,"hex")})).join(" ")}},{key:"toBuffer",value:function(){return this.chunks.reduce((function(t,e){if("OpCode"===e.constructor.name)return T.join([t,e.toBuffer()]);var n,r=e.length;return r>0&&r<76?(n=T.create(1),T.writeUInt8(n,r,0),e=T.join([n,e])):r<256?(n=T.create(1),T.writeUInt8(n,r,0),e=T.join([D("OP_PUSHDATA1").toBuffer(),n,e])):r<65536?(n=T.create(2),T.writeUInt16LE(n,r,0),e=T.join([D("OP_PUSHDATA2").toBuffer(),n,e])):r<4294967296&&(n=T.create(4),T.writeUInt32LE(n,r,0),e=T.join([D("OP_PUSHDATA4").toBuffer(),n,e])),T.join([t,e])}),T.from(""))}},{key:"toHex",value:function(){return T.to(this.toBuffer(),"hex")}}],[{key:"fromASM",value:function(t){return new this(t.split(" ").map((function(t){if("0"===t)return D(0);if("-1"===t)return D("OP_1NEGATE");try{return D(t)}catch(e){return T.from(t,"hex")}})))}},{key:"fromBuffer",value:function(t){if(!T.is(t))throw new Error("Data not a valid binary buffer");return new this(this._parseBufferR(t,[]))}},{key:"fromHex",value:function(t){var e=T.from(t,"hex");return this.fromBuffer(e)}},{key:"_parseBufferR",value:function(t,e){if(0===t.length)return e;var n,r,o,u=T.readUInt8(t,0);return u>0&&u<76?o=(n=T.subarray(t,1,u+1)).length+1:76===u?(r=T.readUInt8(t,1),o=(n=T.subarray(t,2,r+2)).length+2):77===u?(r=T.readUInt16LE(t,1),o=(n=T.subarray(t,3,r+3)).length+3):78===u?(r=T.readUInt32LE(t,1),o=(n=T.subarray(t,5,r+5)).length+5):(n=D(u),o=1),e.push(n),this._parseBufferR(T.subarray(t,o),e)}}]),Script}();return{binary:T,Script:Script,OpCode:D}}));
