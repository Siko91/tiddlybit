/**
 * TiddlyBit - v0.0.4
 * A tiddly JavaScript library for constructing, parsing and serializing Bitcoin scripts.
 * https://github.com/libitx/tiddlybit#readme
 * Copyright Â© 2020 libitx. MIT License
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).TiddlyBit=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var o=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){!function(t){var e="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),r="/".charCodeAt(0),o="0".charCodeAt(0),f="a".charCodeAt(0),i="A".charCodeAt(0),u="-".charCodeAt(0),a="_".charCodeAt(0);function O(t){var e=t.charCodeAt(0);return e===n||e===u?62:e===r||e===a?63:e<o?-1:e<o+10?e-o+26+26:e<i+26?e-i:e<f+26?e-f+26:void 0}t.toByteArray=function(t){var n,r,o,f,i,u;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var a=t.length;i="="===t.charAt(a-2)?2:"="===t.charAt(a-1)?1:0,u=new e(3*t.length/4-i),o=i>0?t.length-4:t.length;var c=0;function P(t){u[c++]=t}for(n=0,r=0;n<o;n+=4,r+=3)P((16711680&(f=O(t.charAt(n))<<18|O(t.charAt(n+1))<<12|O(t.charAt(n+2))<<6|O(t.charAt(n+3))))>>16),P((65280&f)>>8),P(255&f);return 2===i?P(255&(f=O(t.charAt(n))<<2|O(t.charAt(n+1))>>4)):1===i&&(P((f=O(t.charAt(n))<<10|O(t.charAt(n+1))<<4|O(t.charAt(n+2))>>2)>>8&255),P(255&f)),u},t.fromByteArray=function(t){var e,n,r,o,f=t.length%3,i="";function u(t){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)}for(e=0,r=t.length-f;e<r;e+=3)n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],i+=u((o=n)>>18&63)+u(o>>12&63)+u(o>>6&63)+u(63&o);switch(f){case 1:i+=u((n=t[t.length-1])>>2),i+=u(n<<4&63),i+="==";break;case 2:i+=u((n=(t[t.length-2]<<8)+t[t.length-1])>>10),i+=u(n>>4&63),i+=u(n<<2&63),i+="="}return i}}(e)})),f=function(t,e){if(Array.isArray(t))return new Uint8Array(t);return i[e||"utf8"](t)},i={hex:function(t){for(var e=t.length/2,n=new Uint8Array(e),r="",o=0,f=t.length;o<f;++o)r+=t.charAt(o),o>0&&o%2==1&&(n[o>>>1]=parseInt(r,16),r="");return n},utf8:function(t){for(var e,n=[],r=0,o=t.length;r<o;++r)!1!==(e=a(t,r))&&(e<128?n[n.length]=e:u(n,e));return new Uint8Array(n)},base64:function(t){return new Uint8Array(o.toByteArray(t))}};function u(t,e){var n,r,o,f=e,i=0;do{++i}while(f>>>=1);for(r|=[0,0,192,224,240,248,252][n=0|Math.ceil((i-1)/5)],i=7-(o=[0,0,3,4,5,6,7][n])+6*(n-1);i;)r|=+!!(e&1<<i)<<7-o,++o%8==0&&(t[t.length]=r,r=128,o=2),--i;o&&(r|=+!!(1&e)<<7-o,t[t.length]=r)}function a(t,e){e=e||0;var n,r,o=t.charCodeAt(e);if(55296<=o&&o<=56319){if(n=t.charCodeAt(e+1),r=o,isNaN(n))throw new Error("High surrogate not followed by low surrogate");return 1024*(r-55296)+(n-56320)+65536}return!(56320<=o&&o<=57343)&&o}var O=function(t,e,n){n=void 0===n?t.length:n;var r,o,f=0,i=0;P.length=c.length=0;for(;f<t.length;)o=t[f],!i&&128&o?(r=_(o),i+=r,r<8&&(P[P.length]=o&l[6-r])):i?(P[P.length]=o&l[6],!--i&&P.length&&(c[c.length]=h(g(P)),P.length=0)):c[c.length]=h(o),++f;P.length&&!i&&(c[c.length]=h(g(P)),P.length=0);return c.join("")},c=[],P=[],h=String.fromCharCode,s=[64,32,16,8,4,2,1],l=[0,1,3,7,15,31,63,127];function _(t){for(var e=0;e<7&&t&s[e];++e);return e}function g(t){for(var e=0,n=0,r=t.length;n<r;++n)e|=t[n]<<6*(r-n-1);return e}var E=function(t,e){return y[e||"utf8"](t)},y={hex:function(t){for(var e,n="",r=0,o=t.length;r<o;++r)e=t[r],n+=((240&e)>>>4).toString(16),n+=(15&e).toString(16);return n},utf8:function(t){return O(t)},base64:function(t){return o.fromByteArray(t)}};var A=function(t,e,n){return t.subarray(e||0,n||t.length)};var v=function(t,e){if(!t.length)return new Uint8Array(0);var n=void 0!==e?e:function(t){for(var e=0,n=0,r=t.length;n<r;++n)e+=t[n].byteLength;return e}(t),r=new Uint8Array(n),o=t[0],f=o.length,i=0,u=0,a=0;for(;a<n;)u!==f?r[a++]=o[u++]:(u=0,++i,o=t[i],f=o&&o.length);return r};var d=function(t,e,n,r,o){if(n=arguments.length<3?0:n,r=arguments.length<4?0:r,(o=arguments.length<5?t.length:o)===r)return;if(0===e.length||0===t.length)return;o>t.length&&(o=t.length);e.length-n<o-r&&(o=e.length-n+r);if(t.buffer!==e.buffer)return U(t,e,n,r,o);return b(t,e,n,r,o)},I=[].slice;function U(t,e,n,r,o){for(var f=o-r+n,i=n,u=r;i<f;++i,++u)e[i]=t[u]}function b(t,e,n,r,o){for(var f=o+r,i=new Uint8Array(I.call(t,r,f)),u=0;r<f;++r,++u)e[n++]=i[u]}var p,w,S=p={};w="undefined"==typeof WeakMap?null:new WeakMap,p.get=w?function(t){var e=w.get(t.buffer);e||w.set(t.buffer,e=new DataView(t.buffer,0));return e}:function(t){return new DataView(t.buffer,0)};var N={readUInt8:function(t,e){return t[e]},readInt8:function(t,e){var n=t[e];return n<128?n:n-256},readUInt16LE:function(t,e){return S.get(t).getUint16(e+t.byteOffset,!0)},readUInt32LE:function(t,e){return S.get(t).getUint32(e+t.byteOffset,!0)},readInt16LE:function(t,e){return S.get(t).getInt16(e+t.byteOffset,!0)},readInt32LE:function(t,e){return S.get(t).getInt32(e+t.byteOffset,!0)},readFloatLE:function(t,e){return S.get(t).getFloat32(e+t.byteOffset,!0)},readDoubleLE:function(t,e){return S.get(t).getFloat64(e+t.byteOffset,!0)},readUInt16BE:function(t,e){return S.get(t).getUint16(e+t.byteOffset,!1)},readUInt32BE:function(t,e){return S.get(t).getUint32(e+t.byteOffset,!1)},readInt16BE:function(t,e){return S.get(t).getInt16(e+t.byteOffset,!1)},readInt32BE:function(t,e){return S.get(t).getInt32(e+t.byteOffset,!1)},readFloatBE:function(t,e){return S.get(t).getFloat32(e+t.byteOffset,!1)},readDoubleBE:function(t,e){return S.get(t).getFloat64(e+t.byteOffset,!1)}};var C={writeUInt8:function(t,e,n){return t[n]=e},writeInt8:function(t,e,n){return t[n]=e<0?e+256:e},writeUInt16LE:function(t,e,n){return S.get(t).setUint16(n+t.byteOffset,e,!0)},writeUInt32LE:function(t,e,n){return S.get(t).setUint32(n+t.byteOffset,e,!0)},writeInt16LE:function(t,e,n){return S.get(t).setInt16(n+t.byteOffset,e,!0)},writeInt32LE:function(t,e,n){return S.get(t).setInt32(n+t.byteOffset,e,!0)},writeFloatLE:function(t,e,n){return S.get(t).setFloat32(n+t.byteOffset,e,!0)},writeDoubleLE:function(t,e,n){return S.get(t).setFloat64(n+t.byteOffset,e,!0)},writeUInt16BE:function(t,e,n){return S.get(t).setUint16(n+t.byteOffset,e,!1)},writeUInt32BE:function(t,e,n){return S.get(t).setUint32(n+t.byteOffset,e,!1)},writeInt16BE:function(t,e,n){return S.get(t).setInt16(n+t.byteOffset,e,!1)},writeInt32BE:function(t,e,n){return S.get(t).setInt32(n+t.byteOffset,e,!1)},writeFloatBE:function(t,e,n){return S.get(t).setFloat32(n+t.byteOffset,e,!1)},writeDoubleBE:function(t,e,n){return S.get(t).setFloat64(n+t.byteOffset,e,!1)}};var L={},T=L;function R(t,e){for(var n in t)e[n]=t[n]}L.from=f,L.to=E,L.is=function(t){return t instanceof Uint8Array},L.subarray=A,L.join=v,L.copy=d,L.create=function(t){return new Uint8Array(t)},R(N,L),R(C,L);var D={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SPLIT:127,OP_NUM2BIN:128,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_CHECKLOCKTIMEVERIFY:177,OP_CHECKSEQUENCEVERIFY:178,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255,inverse:{}};Object.keys(D).forEach((function(t){if(/^OP_/.test(t)){var e=D[t];D.inverse[e]=t}}));var OpCode=function(){function OpCode(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e(this,OpCode),this.op=t.toUpperCase(),this.code=D[this.op],Object.freeze(this),!this.isValid)throw new Error("Invalid OpCode: ".concat(t))}return r(OpCode,[{key:"toBuffer",value:function(){var t=T.create(1);return T.writeUInt8(t,this.code,0),t}},{key:"inspect",value:function(){return"<OpCode ".concat(this.code," ").concat(this.op,">")}},{key:"isValid",get:function(){return!!this.op&&Number.isInteger(this.code)}}]),OpCode}(),B=Object.keys(D).reduce((function(t,e){return/^OP_/.test(e)&&(t[e]=new OpCode(e)),t}),{});B.byCode=function(t,e){var n=D.inverse[t];if(n)return B[n];if(e)throw new Error("Invalid OpCode: ".concat(t));return null},Object.freeze(B);var H={OpCode:OpCode,Ops:B},m=H.OpCode,F=H.Ops,Script=function(){function Script(t){e(this,Script),this.chunks=[],this.push(t)}return r(Script,[{key:"push",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e))return this.push([e]);for(var n=0;n<e.length;n++){var r=e[n],o=t(r),f=void 0;T.is(r)||r instanceof m?f=r:Array.isArray(r)&&r.every((function(t){return Number.isInteger(t)&&t<=255}))?f=T.from(r):"string"===o?f=T.from(r):"number"===o&&(f=F.byCode(r)),f&&this.chunks.push(f)}return this}},{key:"toASM",value:function(){for(var t=[],e=0;e<this.chunks.length;e++){var n=this.chunks[e];if(n instanceof m)0===n.code||n.code===F.OP_1NEGATE.code?t.push(n.code):t.push(n.op);else{var r=T.to(n,"hex");t.push(r)}}return t.join(" ")}},{key:"toBuffer",value:function(){for(var t=T.from(""),e=0;e<this.chunks.length;e++){var n=this.chunks[e];if(n instanceof m)t=T.join([t,n.toBuffer()]);else{var r=n.length,o=void 0;r>0&&r<76?(o=T.create(1),T.writeUInt8(o,r,0),n=T.join([o,n])):r<256?(o=T.create(1),T.writeUInt8(o,r,0),n=T.join([F.OP_PUSHDATA1.toBuffer(),o,n])):r<65536?(o=T.create(2),T.writeUInt16LE(o,r,0),n=T.join([F.OP_PUSHDATA2.toBuffer(),o,n])):r<4294967296&&(o=T.create(4),T.writeUInt32LE(o,r,0),n=T.join([F.OP_PUSHDATA4.toBuffer(),o,n])),t=T.join([t,n])}}return t}},{key:"toHex",value:function(){return T.to(this.toBuffer(),"hex")}}],[{key:"fromASM",value:function(t){for(var e=t.split(" "),n=[],r=0;r<e.length;r++){var o=e[r];if("0"===o)n.push(F.OP_0);else if("-1"===o)n.push(F.OP_1NEGATE);else{var f=F[o]||T.from(o,"hex");n.push(f)}}return new this(n)}},{key:"fromBuffer",value:function(t){if(!T.is(t))throw new Error("Data not a valid binary buffer");for(var e=[],n=0;n<t.length;){var r=T.readUInt8(t,n),o=void 0,f=void 0,i=void 0;r>0&&r<76?i=(o=T.subarray(t,n+1,n+r+1)).length+1:76===r?(f=T.readUInt8(t,n+1),i=(o=T.subarray(t,n+2,n+f+2)).length+2):77===r?(f=T.readUInt16LE(t,n+1),i=(o=T.subarray(t,n+3,n+f+3)).length+3):78===r?(f=T.readUInt32LE(t,n+1),i=(o=T.subarray(t,n+5,n+f+5)).length+5):(o=F.byCode(r,!0),i=1),e.push(o),n+=i}return new this(e)}},{key:"fromHex",value:function(t){var e=T.from(t,"hex");return this.fromBuffer(e)}}]),Script}();return{binary:T,Script:Script,OpCode:m,Ops:F}}));
